{% extends 'base.html' %}
{% from 'macros.html' import pager, header %}
{% block header_social %}
    {{ header(contested_races_title, contested_races_type | contested_races_description, request.path) }}
{% endblock %}
{% block content %}

<h1><i class='fa fa-times-circle fa-fw'></i>Contested Races <small> Illinois General Assembly, updated daily</small></h1>

<div class="row">
    <div class="col-sm-12">

        <ul class="nav nav-pills">
          <li role="presentation" {% if contested_races_type == "House of Representatives"%}class="active"{% else %}class="inactive"{% endif %}><a href="{{ url_for('views.contested_races') }}?type=house_of_representatives">House of Representatives  </a></li>
          <li role="presentation" {% if contested_races_type == "Senate"%}class="active"{% else %}class="inactive"{% endif %}><a href="{{ url_for('views.contested_races') }}?type=senate">  Senate</a></li>
        </ul>
	
        <h2>{{contested_races_title}}</h3>

        <p>{{ contested_races_type | contested_races_description }}</p>
        <div class="panel panel-default">
            <div class="panel-body"></div>
        </div>

    </div>
</div>	

{% for key, value in contested_dict | dictsort %}
    <div class="row">
        <div class="col-sm-12">
            <h2><i class='fa fa-flag-checkered'></i> District {{ key }}<br/>
                <small>Total Money in Race: <strong>{{ total_funds[key]|format_money }}</strong></small>
            </h2>
            
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">

            {% for committee_dict in value %}
                <div class="col-sm-6">
                    {%set candidate_slug = [committee_dict.first|string, committee_dict.last|string]|join('-') %}
                    <h2>{% if committee_dict.candidate_id %}<a href='{{ url_for('views.candidate', candidate_id=committee_dict.candidate_id ) }}'>{{committee_dict.first}} {{committee_dict.last}}</a>{% else %} <u>{{ committee_dict.first }}  {{ committee_dict.last }}</u>{% endif %} ({{ committee_dict.party }}) <small><strong> {% if committee_dict.incumbent|string() == 'Y' %}  *INCUMBENT{% endif %}</strong></small></h2> 
                    {% if committee_dict.committee %} 
                            <h3><a href='{{ url_for('views.committee', committee_id = committee_dict.id) }}'>{{ committee_dict.committee_name }}</a></h3>
                            <table class="table table-striped table-bordered">
                                <thead>
                                    <th>Committee Funds</th>
                                    <th class='text-right'>Amount</th>
                                </thead>
                                <tbody>
                                        <tr>
                                            {% if committee_dict.latest_filing and committee_dict.latest_filing.reporting_period_end %}
                                                <td>Funds available on {{ committee_dict.latest_filing.reporting_period_end.strftime('%b %d, %Y') }} quarterly report</td>
                                                <td class='text-right'>{{ committee_dict.latest_filing.end_funds_available|format_money }}</td>
                                            {% else %}
                                                <td>Funds available</td>
                                                <td class='text-right'>$0</td>
                                            {% endif %}
                                        </tr>
                                        <tr>
                                            {% if committee_dict.latest_filing and committee_dict.latest_filing.reporting_period_end %}
                                                <td>Contributions since {{ committee_dict.latest_filing.reporting_period_end.strftime('%b %d, %Y')}}</td>
                                            {% else %}                
                                                <td>Contributions</td> 
                                            {% endif %}
                                            <td class='text-right'>{% if committee_dict.recent_total %}{{ committee_dict.recent_total|format_money }}{% else %}$0{% endif %}</td>
                                        </tr>
                                </tbody>
                                <tfoot>
                                    <tr>
                                        <td><strong>Total funds</strong></td>
                                        <td class='text-right'><strong>{% if committee_dict.controlled_amount %}{{ committee_dict.controlled_amount|format_money }}{% else %}$0{% endif %}</strong></td>
                                    </tr>
                                </tfoot>
                            </table>
                            <br />
                            <div class="row">
                                <div class="col-sm-9">
                                    <table class = "table table-striped table-bordered">
                                        <tbody>
                                                <tr>
                                                    <td>Investments</td>
                                                    <td class='text-right'>{% if committee_dict.latest_filing and committee_dict.latest_filing.total_investments %}{{ committee_dict.latest_filing.total_investments|format_money }}{% else %}$0{% endif %}</td>
                                                </tr>
                                                <tr>
                                                    <td>Debts and obligations</td>
                                                    <td class='text-right'>{% if committee_dict.latest_filing and committee_dict.latest_filing.total_debts %}{{ committee_dict.latest_filing.total_debts|format_money }}{% else %}$0{% endif %}</td>
                                                </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <h2><small>Total Independent Expenditures Supporting: {% if committee_dict.supporting_funds and committee_dict.candidate_id %}<a href="{{ url_for('views.independent_expenditures', candidate_id=committee_dict.candidate_id, stance="supporting" )}}">
                                <strong>{{ committee_dict.supporting_funds|format_money }}</strong></a>{% else %}</strong>$0</strong>{% endif %}<br />Total Independent Expenditures Opposing: {% if committee_dict.opposing_funds and committee_dict.candidate_id %}<a href="{{ url_for('views.independent_expenditures', candidate_id=committee_dict.candidate_id,stance="opposing" )}}">
                                <strong>{{ committee_dict.opposing_funds|format_money }}</strong></a>{% else %}<strong>$0</strong>{% endif %}</small></h2>
                            <br />
                    {% else %}
                        <h3> <br/></h3>
                        <div class="well well-lg">
                            <table class="table">
                                <thead>
                                    <th>Committee N/A</th>
                                </thead>
                            </table>
                            <h3><i class='fa fa-fw fa-info-circle'></i> No candidate committee filed at this time.</h3>
                            <br /><br /></br />
                        </div>    
                    {% endif %}
 
                </div>
           {% endfor %}
        </div>
    </div>

{% endfor %}

{% endblock %}
