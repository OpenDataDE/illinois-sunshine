{% extends 'base.html' %}
{% block title %}Keep an eye on money in Illinois politics{% endblock %}
{% block extra_styles %}
    <link href="{{ url_for('static', filename='css/jquery-ui.min.css') }}" rel="stylesheet">
{% endblock %}
{% block content %}
<div class='well'>
    <p class='lead'><strong></strong> Keep an eye on money in Illinois politics.</p>
</div>
<h3>Recent political contributions</h3>
<p>The 10 most recent reported contributions. <a href='{{ url_for('views.recent_contributions') }}'>See more &raquo;</a></p>
<table class="table table-bordered table-condensed">
    <thead>
        <tr>
            <th>Contribution</th>
            <th>Amount</th>
            <th>Received</th>
        </tr>
    </thead>
    <tbody>
        {% for donation in recent_donations %}
            <tr>
                <td>
                    <strong>{% if donation.first_name %}{{ donation.first_name }}{% endif %} {{ donation.last_name }}</strong> donated to
                    <a href="{{ url_for('views.committee', committee_id=donation.committee_id )}}">{{ donation.committee.name }}</a>
                </td>
                <td>{{ donation.amount|format_money }}</td>
                <td>{{ donation.filed_doc.received_datetime.strftime('%b %d, %Y %-I:%M%p') }}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

<h3>Candidates with the most money</h3>
<p>The 10 candidates with the most money available in their committees.</p>
<table class="table table-bordered table-condensed">
    <thead>
        <tr>
            <th>#</th>
            <th>Candidate</th>
            <th>Campaign funds</th>
        </tr>
    </thead>
    <tbody>
        {% for record in top_ten %}
            <tr>
                <td>{{ loop.index }}</td>
                <td><a href="{{ url_for('views.candidate', candidate_id=record.candidate_id ) }}">{{ record.candidate_first_name }} {{ record.candidate_last_name }}</a></td>
                <td>{{ record.total|format_money }}</td>
            </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
{% block extra_javascript %}
    <script src="{{ url_for('static', filename='js/spin.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/jquery.spin.js') }}"></script>
    <script src="{{ url_for('static', filename='js/ejs_production.js') }}"></script>
    <script type="text/EJS" id="searchResult">
        <div class="search-result">
            <h3><%= result.name %></h3>
            <p>
                <% if (typeof result.committees !== 'undefined'){ %>
                    <strong><%= result.committees.length %></strong> committees <br />
                <% } %>
                <% if (typeof result.candidates !== 'undefined'){ %>
                    <strong><%= result.candidates.length %></strong> candidates <br />
                <% } %>
                <% if (typeof result.officers !== 'undefined'){ %>
                    <strong><%= result.officers.length %></strong> officers <br />
                <% } %>
                <% if (typeof result.receipts !== 'undefined'){ %>
                    <strong><%= result.receipts.length %></strong> receipts <br />
                <% } %>
                <% if (typeof result.expenditures !== 'undefined'){ %>
                    <strong><%= result.expenditures.length %></strong> expenditures <br />
                <% } %>
                <% if (typeof result.investments !== 'undefined'){ %>
                    <strong><%= result.investments.length %></strong> investments
                <% } %>
        </div>
    </script>
    <script type="text/javascript">
        $(document).ready(function(){
            $('button.btn').on('click', function(e){
                e.preventDefault();
                $('#search-results').empty();
                $('#search-results').spin('large');
                var term = $('#search').val();
                $.getJSON("{{ url_for('api.name_search') }}", {'term': term}, function(resp){
                    $('#search-results').spin(false);
                    var template = new EJS({'text': $('#searchResult').html()});
                    $.each(resp, function(i, result){
                        $('#search-results').append(template.render({'result': result}));
                    })
                })
            })
        })
    </script>
{% endblock %}
